# Disaster Recovery — восстановление сервиса с нуля

## Когда использовать этот документ
- сервер упал / удалён
- перенос на новый VPS
- восстановление после критической ошибки
- поднятие staging/копии проекта

Цель: восстановить сервис за 10–15 минут.

---

## Предварительные требования
- VPS с Ubuntu 24.04
- доступ по SSH (ключи настроены)
- домен и DNS уже указывают на сервер
- SSL будет получен отдельно (certbot / nginx)

---

## 1. Базовая подготовка сервера
- обновление системы
- установка Docker и Docker Compose
- проверка времени и таймзоны

---

## 2. Получение проекта
- клонировать репозиторий
- перейти в каталог проекта

---

## 3. Переменные окружения
- скопировать `.env.example` → `.env`
- заполнить значения вручную:
  - BOT_TOKEN
  - YOOKASSA_*
  - MARZBAN_BASE_URL
  - MARZBAN_ADMIN_USERNAME
  - MARZBAN_ADMIN_PASSWORD
  - PUBLIC_BASE_URL
- проверить, что `.env` не попадает в git

---

## 4. Запуск сервисов
- сборка контейнеров
- запуск через docker compose
- проверка статуса контейнеров

---

## 5. Проверки после запуска
- бот отвечает в Telegram
- доступен API Marzban
- тестовый платёж (если включено)
- логи без ошибок

---

## 6. Частые проблемы
- бот не стартует → проверить `.env`
- 401 от Marzban → проверить admin username/password (бот сам перевыпустит токен)
- webhook не приходит → проверить URL и SSL

---

## 7. Что НИКОГДА не хранить в репозитории
- `.env`
- приватные ключи
- реальные токены и секреты
- дампы с персональными данными

---

## Контрольный чеклист (TL;DR)
- [ ] Сервер обновлён
- [ ] Docker установлен
- [ ] Репозиторий клонирован
- [ ] `.env` заполнен
- [ ] Контейнеры запущены
- [ ] Бот отвечает
